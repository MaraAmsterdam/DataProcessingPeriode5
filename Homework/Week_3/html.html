<!DOCTYPE html>
<html>
<head>
	<title> Testing </title>
</head>
<body>
	<canvas id="canvas" width="800" height="800"></canvas>
	<script type="text/javascript">
    var fileName = "data.json";
    var txtFile = new XMLHttpRequest();
    txtFile.onreadystatechange = function() {
	    if (txtFile.readyState === 4 && txtFile.status == 200) {
	        // console.log(JSON.parse(txtFile.responseText));
	        var data_raw = JSON.parse(txtFile.responseText)
	        var data = {};
	      
	        for (var key in data_raw) {
		    	data[key] = data_raw[key]['bedden'];
	        }

	        // Find maximum y-value
	        var arrY = Object.values(data);
	        var maxY = Math.max(...arrY);

	        //Find maximum and minimum x-values
	        var arrX = Object.keys(data);
	        var minX = Math.min(...arrX);
			var maxX = Math.max(...arrX);
			     

	        xScale = createTransform([minX,maxX], [10,790]);
	        yScale = createTransform([0,maxY],[790,10]);


	        function createTransform(domain, range){
				// domain is a two-element array of the data bounds [domain_min, domain_max]
				// range is a two-element array of the screen bounds [range_min, range_max]
				// this gives you two equations to solve:
				// range_min = alpha * domain_min + beta
				// range_max = alpha * domain_max + beta
			 		// a solution would be:

			    var domain_min = domain[0]
			    var domain_max = domain[1]
			    var range_min = range[0]
			    var range_max = range[1]

			    // formulas to calculate the alpha and the beta
			   	var alpha = (range_max - range_min) / (domain_max - domain_min)
			    var beta = range_max - alpha * domain_max

			    // returns the function for the linear transformation (y= a * x + b)
			    return function(x){
			      return alpha * x + beta;
			    }
			}

			for (var key in data){
				console.log(xScale(key),yScale(data[key]));
			}
			

		    var canvas = document.getElementById('canvas');
		    // Check
		    if (canvas.getContext){
		    	var context = canvas.getContext('2d');
		    	// reset
		    	var middle = 200;
		    	context.beginPath();
		    	// Starting point
		    	context.moveTo(middle,yScale(data[2007]));
		    	
		    	for (var key in data){
				context.lineTo(xScale(key)+middle,yScale(data[key]));
				context.stroke();
				}
				context.closePath();

				context.beginPath();
				context.moveTo(middle,400);
				context.lineTo(maxX,400);
				context.stroke();
				context.closePath();

				context.beginPath();
				context.moveTo(middle,400);
				context.lineTo(middle,0);
				context.stroke();
				context.closePath();

				for (var key in data){
				context.beginPath();
				context.moveTo(xScale(key)+middle,400);
				context.lineTo(xScale(key)+middle,415);
				context.stroke();
				context.closePath();

				context.beginPath();
				context.moveTo(middle,400);
				context.lineTo(middle,385);
				context.stroke();
				context.closePath();
				}
				



		    }


	    }
    }
    txtFile.open("GET", fileName);
    txtFile.send();
	</script>
</body>
</html>