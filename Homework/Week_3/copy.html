<!DOCTYPE html>
<html>
<head>
	<title> Line graph </title>
</head>
<body>
	<canvas id="canvas" width="800" height="800"></canvas>
	<script type="text/javascript">
    var fileName = "data.json";
    var txtFile = new XMLHttpRequest();

        function createTransform(domain, range){

	    var domain_min = domain[0]
	    var domain_max = domain[1]
	    var range_min = range[0]
	    var range_max = range[1]

	   	var alpha = (range_max - range_min) / (domain_max - domain_min)
	    var beta = range_max - alpha * domain_max

	    return function(x){
	      return alpha * x + beta;
	    }	    
	}

    txtFile.onreadystatechange = function() {
	    if (txtFile.readyState === 4 && txtFile.status == 200) {
	        // console.log(JSON.parse(txtFile.responseText));
	        var data_raw = JSON.parse(txtFile.responseText)
	        var data = {};
	      
	        for (var key in data_raw) {
		    	data[key] = data_raw[key]['bedden'];
	        }

	        // Find maximum y-value
	        var arrY = Object.values(data);
	        var maxY = Math.max(...arrY);


	        //Find maximum and minimum x-values
	        var arrX = Object.keys(data);
	        var minX = Math.min(...arrX);
			var maxX = Math.max(...arrX);
			     
			// Calculate lineair transformation for both axes
	        xScale = createTransform([minX,maxX], [10,500]);
	        yScale = createTransform([0,maxY],[700,20]);
	        

			/*for (var key in data){
				console.log(xScale(key),yScale(data[key]));
			}*/
			

		    var canvas = document.getElementById('canvas');
		    // Check
		    if (canvas.getContext){
		    	var context = canvas.getContext('2d');
		    	// reset
		    	var middle = 160;
		    	context.beginPath();
		    	context.font = '30px Arial';
				context.fillText('Hello world', 200, 70);
				context.fillText('bron', 200,700);
		    	// Starting point
		    	context.moveTo(middle,yScale(data[2007]) + middle);
		    	
		    	for (var key in data){
				context.lineTo(xScale(key) + middle,yScale(data[key]) + middle);
				context.stroke();
				}
				context.closePath();
				// Draw x-axis
				context.beginPath();
				context.moveTo(middle,400 + middle);
				context.lineTo(middle + xScale(2017),400 + middle);
				context.stroke();
				context.closePath();

				// Draw y-axis
				context.beginPath();
				context.moveTo(middle,400 + middle);
				context.lineTo(middle,yScale(80000) + middle);
				context.stroke();
				context.closePath();

				// Draw x-ticks
				for (var key in data){
				context.beginPath();
				context.moveTo(xScale(key) + middle,400 + middle);
				context.lineTo(xScale(key) + middle,415 + middle);
				context.stroke();
				context.closePath();
				}


				// Draw y ticks 
				for (i = 0; i < 7; i++){	
				var factor = ( 80000 / 10 ) * i;	
				var factorTicks = 80000 - factor;
				//console.log(factor);		
				context.beginPath();

				context.moveTo(middle,yScale(80000 - factor) + middle);
				context.lineTo(middle - 15,yScale(80000 - factor) + middle);
				context.stroke();

				context.font = '10px Arial';
				context.fillText(factorTicks, 110, yScale(80000 - factor) + middle );

				context.closePath();
				}

				
		    }

	    }
    }
    
    txtFile.open("GET", fileName);
    txtFile.send();
	</script>
</body>
</html>